@page "/Search"
@using GeocodeService
@using Infrastructure.Data
@using NorthernIrelandPowerOutages.Models
@using NorthernIrelandPowerOutages.Services
@inject IFaultPollingService FaultPollingService
@inject HttpClient httpClient
@rendermode InteractiveServer
@inject IGeocodeService GeocodeService
@inject ApplicationDbContext DbContext
@inject AuthenticationStateProvider AuthenticationStateProvider
@inject HttpClient Http

<h3>Search</h3>

<div class="input-group mb-3">
    <input type="text" @bind="postCode" class="form-control" placeholder="Enter postcode" aria-label="Enter postcode" />
    <button class="btn btn-primary" @onclick="SearchByPostCode">Search</button>
</div>

@if (fault != null && fault.OutageMessage != null && fault.OutageMessage.Any())
{
    <div class="container-fluid">
        @foreach (var outage in fault.OutageMessage)
        {
            <div class="row mb-4">
                <div class="col-12">
                    <div class="card h-100 shadow-sm">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <div class="col-md-3">
                                    <h5 class="card-title text-primary mb-0">ID: @outage.OutageId</h5>
                                </div>
                                <div class="col-md-3">
                                    <h6 class="card-subtitle text-muted mb-0">Type: @outage.OutageType</h6>
                                </div>
                                <div class="col-md-2">
                                    <p class="card-text mb-0">Post Code: @outage.PostCode</p>
                                </div>
                                <div class="col-md-3">
                                    @* Adjusted column size slightly to accommodate button *@
                                    <p class="card-text mb-0">Status: @outage.StatusMessage</p>
                                </div>
                                <div class="col-md-1 text-end">
                                    @* Column for the heart button, aligned to the end *@
                                    <button class="btn btn-outline-danger btn-sm"
                                            @onclick='() => ToggleFavorite(outage)'
                                            aria-label="Toggle Favorite">
                                        <i class="bi bi-heart"></i> @* Bootstrap Heart Icon *@
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        }
    </div>
}
else
{
    <div class="alert alert-info" role="alert">
        No fault data available yet. Please enter a postcode and search.
    </div>
}

@if (!string.IsNullOrEmpty(faultInfo))
{
    <div class="alert alert-warning mt-3" role="alert">
        @faultInfo
    </div>
}
